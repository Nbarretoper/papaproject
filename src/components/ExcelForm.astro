---
import Input from "./Input.astro";
import Select from "./Select.astro";
import { getUruguayDate } from "../utils/getUruguayDate.js";
import { server } from "../actions/index.ts";

const uruguayDate = getUruguayDate();
const vehiculoOptions = [
  { value: "F1", label: "F1" },
  { value: "F2", label: "F2" },
  { value: "F4", label: "F4" },
  { value: "F5", label: "F5" },
  { value: "F6", label: "F6" },
  { value: "CO", label: "CO" },
  { value: "CC", label: "CC" },
  { value: "Helado", label: "Helado" },
  { value: "Eventual", label: "Eventual" },
];

const razonesOptions = [
  { value: "roto", label: "Roto" },
  { value: "sobro", label: "Sobró" },
  { value: "falto", label: "Faltó" },
  { value: "cambiado", label: "Cambiado" },
  { value: "razon_secos", label: "Razón Secos" },
  { value: "otros", label: "Otros" },
];
---

<div class="flex flex-col items-center justify-center min-h-screen p-4">
  <img src="../LogoSinFondo.png" alt="LogoDistrilog" class="w-26 h-auto mb-4" />
  <div class="bg-white p-6 md:p-8 rounded-lg shadow-lg w-full max-w-md">
    <h1 class="text-2xl font-bold mb-6 text-center">
      PLANILLA DE CONTROL <br /> FIN DE REPARTO
    </h1>
    <form
      id="controlForm"
      class="space-y-4"
      method="post"
      action={server.excelForm}
    >
      <!-- Fecha -->
      <Input
        label="Fecha"
        type="text"
        name="fecha"
        value={uruguayDate}
        placeholder="DD/MM/AAAA"
        class="w-full p-2 border border-gray-300 rounded"
      />

      <!-- Numero de camioneta -->
      <Select
        label="Número de camioneta"
        name="camioneta"
        options={vehiculoOptions}
        class="w-full p-2 border border-gray-300 rounded"
      />

      <!-- Articulo -->
      <Input
        label="Artículo"
        type="text"
        name="articulo"
        placeholder="Artículo"
        class="w-full p-2 border border-gray-300 rounded"
      />

      <!-- Cantidad -->
      <Input
        label="Cantidad"
        type="number"
        name="cantidad"
        placeholder="Cantidad"
        class="w-full p-2 border border-gray-300 rounded"
      />

      <!-- Motivo -->
      <Select
        label="Motivo"
        name="motivo"
        options={razonesOptions}
        class="w-full p-2 border border-gray-300 rounded"
      />

      <!-- Chofer -->
      <Input
        label="Chofer"
        type="text"
        name="chofer"
        placeholder="Chofer"
        class="w-full p-2 border border-gray-300 rounded"
      />

      <!-- Otros -->
      <Input
        label="Otros"
        type="text"
        name="otros"
        placeholder="Otros"
        class="w-full p-2 border border-gray-300 rounded"
      />

      <!-- Boton de enviar -->
      <button
        type="submit"
        class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600"
      >
        Enviar
      </button>
    </form>
  </div>
</div>

<script>
  import { isInputError, actions } from "astro:actions";

  const { setInputError } = actions;
  const form = document.getElementById("contact-form") as HTMLFormElement;

  function validateForm() {
    const inputs = form.querySelectorAll("input, select");

    inputs.forEach((input) => {
      if (!input.value) {
        setInputError(input.name, true);
      } else {
        setInputError(input.name, false);
      }
    });
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    validateForm();

    const { data, error } = await actions.excelForm(formData);

    if (data) {
      form.reset();
    }

    if (error) {
      console.error(error);
    }
  });
</script>
